(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{193:function(t,e,n){"use strict";n(199),n(201);var r=n(197),o=n.n(r),c=n(50);if(o.a.initializeApp(c.a.firebase),!o.a.auth||!o.a.database)throw Error("firebase auth and database are not supported");o.a.auth().signInAnonymously();var l=o.a.database();e.a=l},196:function(t,e,n){var content=n(207);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(37).default)("0f32f924",content,!0,{sourceMap:!1})},206:function(t,e,n){"use strict";var r=n(196);n.n(r).a},207:function(t,e,n){(e=n(36)(!1)).push([t.i,".chat-contents[data-v-3c6248f3]{max-height:200px;overflow:scroll}.chat-content-flex[data-v-3c6248f3],.chat-input-flex[data-v-3c6248f3]{margin:.2em}",""]),t.exports=e},208:function(t,e,n){var content=n(251);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(37).default)("1260715a",content,!0,{sourceMap:!1})},211:function(t,e,n){"use strict";n(26);var r=n(0),o=n(193),c=r.default.extend({name:"Chat",props:{roomId:{type:String,required:!0},myNickname:{type:String,required:!0}},data:function(){return{chatCount:0,chats:[],chatInputMessage:""}},mounted:function(){var t=this;o.a.ref("/rooms/".concat(this.roomId,"/messages")).on("child_added",(function(e){if(e&&e.val()){var data=e.val();t.chats.push({id:"chatid-".concat(t.chatCount+1),nickname:data.name,content:data.content}),t.chatCount++}}))},methods:{sendChatMessage:function(){o.a.ref("/rooms/".concat(this.roomId,"/messages")).push({name:this.myNickname,content:this.chatInputMessage}),this.chatInputMessage=""}}}),l=(n(206),n(25)),component=Object(l.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("v-layout",{attrs:{row:""}},[n("v-flex",{staticClass:"chat-content-flex",attrs:{xs12:""}},[n("v-card",{staticClass:"chat-contents transparent-panel"},t._l(t.chats,(function(e){return n("div",{key:e.id},[n("v-chip",{attrs:{label:"",color:"pink","text-color":"white"}},[t._v("\n            "+t._s(e.nickname)+"\n          ")]),t._v(t._s(e.content)+"\n        ")],1)})),0)],1)],1),t._v(" "),n("v-layout",{attrs:{row:""}},[n("v-flex",{staticClass:"chat-input-flex",attrs:{xs12:""}},[n("v-card",{staticClass:"transparent-panel"},[n("v-card-actions",[n("v-text-field",{attrs:{counter:20,"append-icon":"chat",label:"メッセージを入力してください",required:""},on:{"click:append":t.sendChatMessage},model:{value:t.chatInputMessage,callback:function(e){t.chatInputMessage=e},expression:"chatInputMessage"}})],1)],1)],1)],1)],1)}),[],!1,null,"3c6248f3",null);e.a=component.exports},250:function(t,e,n){"use strict";var r=n(208);n.n(r).a},251:function(t,e,n){(e=n(36)(!1)).push([t.i,".battle-movie[data-v-5df957e6]{width:100%;height:280px}.display-label[data-v-5df957e6]{margin:.5em 0;width:100%}.margin-0-2[data-v-5df957e6]{margin:.2em}",""]),t.exports=e},259:function(t,e,n){"use strict";n.r(e);n(218);var r=n(219),o=n.n(r),c=n(0),l=n(211),d=n(50),m=n(193),v=c.default.extend({components:{Chat:l.a},data:function(){return{roomState:"entered",rappers:{me:{nickname:"Waiting...",peerId:"",feedback:{thumbUp:0,thumbDown:0}},competitor:{nickname:"Waiting...",peerId:"",feedback:{thumbUp:0,thumbDown:0}}},peer:void 0,chatCount:0,chats:[],chatMessage:""}},computed:{roomId:function(){return this.$route.query.roomId},roomName:function(){return this.$route.query.roomName},nickname:function(){return this.$route.query.nickname}},mounted:function(){var t=this;this.rappers.me.nickname=this.$route.query.nickname,this.rappers.me.peerId=this.$route.query.peerId,this.roomState="entered",this.$coreApi.get("/rooms/".concat(this.roomId)).then((function(e){var n=e.data.rappers.find((function(e){return e.peerId!==t.peerId}));t.rappers.competitor.peerId=n.peerId})),m.a.ref("/rooms/".concat(this.roomId,"/rappers/").concat(this.rappers.me.peerId,"/feedback")).on("value",(function(e){e&&e.val()&&(t.rappers.me.feedback=e.val())})),this.peer=new o.a(this.rappers.me.peerId,{key:d.a.skywayApiKey,debug:3})},methods:{onStart:function(){var t=this;this.roomState="connecting",navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){return document.getElementById("battle-movie-me").srcObject=e,t.roomState="waiting",e})).then((function(e){t.peer.joinRoom(t.roomId,{mode:"sfu",stream:e}).on("stream",(function(e){console.debug("@@ Incoming stream: ",e),t.$coreApi.get("/rooms/".concat(t.roomId)).then((function(n){var r=n.data.rappers.find((function(e){return e.peerId!==t.rappers.me.peerId}));r.peerId===e.peerId?(t.rappers.competitor.nickname=r.nickname,t.rappers.competitor.peerId=r.peerId,m.a.ref("/rooms/".concat(t.roomId,"/rappers/").concat(t.rappers.competitor.peerId,"/feedback")).on("value",(function(e){console.debug("on competitor feedback value: ",e?e.val():e),e&&e.val()&&(t.rappers.competitor.feedback=e.val())})),t.roomState="fighting"):console.debug("@@ Unexpected stream. This may be not a valid competitor.")})),document.getElementById("battle-movie-competitor").srcObject=e}))}))},sendMessage:function(){m.a.ref("/rooms/".concat(this.$route.query.roomId,"/messages")).push({name:this.rappers.me.nickname,content:this.chatMessage}),this.chatMessage=""}}}),h=(n(250),n(25)),component=Object(h.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("v-layout",{attrs:{row:""}},[n("v-flex",{attrs:{xs12:""}},["entered"===t.roomState?n("v-btn",{staticClass:"display-label",attrs:{dark:"",color:"black"},on:{click:t.onStart}},[t._v("START")]):t._e(),t._v(" "),"connecting"===t.roomState?n("v-btn",{staticClass:"display-label",attrs:{dark:"",color:"black",disabled:""}},[n("v-progress-circular",{attrs:{indeterminate:"",color:"red"}})],1):t._e(),t._v(" "),"waiting"===t.roomState?n("v-btn",{staticClass:"display-label",attrs:{dark:"",color:"black",disabled:""}},[t._v("対戦相手が入場するまでお待ち下さい。")]):t._e(),t._v(" "),"fighting"===t.roomState?n("v-btn",{staticClass:"display-label",attrs:{dark:"",color:"black",disabled:""}},[t._v("FIGHT")]):t._e()],1)],1),t._v(" "),n("v-layout",{attrs:{row:""}},[n("v-flex",{staticClass:"margin-0-2",attrs:{xs6:"","text-xs-center":""}},[n("v-card",{staticClass:"transparent-panel"},[n("video",{staticClass:"battle-movie",attrs:{id:"battle-movie-me",autoplay:"",playsinline:""}}),t._v(" "),n("v-card-title",[n("div",[t._v(t._s(t.rappers.me.nickname))])]),t._v(" "),n("v-card-actions",[n("v-chip",{attrs:{color:"white",label:"",outline:""}},[n("v-avatar",[n("v-icon",{staticClass:"neon"},[t._v("thumb_up")])],1),t._v(" "),n("span",{staticClass:"neon"},[t._v(t._s(t.rappers.me.feedback.thumbUp))])],1),t._v(" "),n("v-spacer"),t._v(" "),n("v-chip",{attrs:{color:"white",label:"",outline:""}},[n("span",{staticClass:"neon-blue"},[t._v(t._s(t.rappers.me.feedback.thumbDown))]),t._v(" "),n("v-avatar",[n("v-icon",{staticClass:"neon-blue thumbDown"},[t._v("thumb_down")])],1)],1)],1)],1)],1),t._v(" "),n("v-flex",{staticClass:"margin-0-2",attrs:{xs6:"","text-xs-center":""}},[n("v-card",{staticClass:"transparent-panel"},[n("video",{staticClass:"battle-movie",attrs:{id:"battle-movie-competitor",autoplay:"",playsinline:""}}),t._v(" "),n("v-card-title",[n("div",[t._v(t._s(t.rappers.competitor.nickname))])]),t._v(" "),n("v-card-actions",[n("v-chip",{attrs:{color:"white",label:"",outline:""}},[n("v-avatar",[n("v-icon",{staticClass:"neon"},[t._v("thumb_up")])],1),t._v(" "),n("span",{staticClass:"neon"},[t._v(t._s(t.rappers.competitor.feedback.thumbUp))])],1),t._v(" "),n("v-spacer"),t._v(" "),n("v-chip",{attrs:{color:"white",label:"",outline:""}},[n("span",{staticClass:"neon-blue"},[t._v(t._s(t.rappers.competitor.feedback.thumbDown))]),t._v(" "),n("v-avatar",[n("v-icon",{staticClass:"neon-blue thumbDown"},[t._v("thumb_down")])],1)],1)],1)],1)],1)],1),t._v(" "),n("chat",{attrs:{"room-id":t.roomId,"my-nickname":t.rappers.me.nickname}})],1)}),[],!1,null,"5df957e6",null);e.default=component.exports}}]);